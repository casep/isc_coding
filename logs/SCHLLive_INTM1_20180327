Script started on Tue 27 Mar 2018 10:13:50 BST

]0;root@schl16intm1:/trak/iscbuild/trakautomation[?1034h[root@schl16intm1 trakautomation]# ./MasterSCHLLive2016INT.sh

Cach√© Password to use: 
Confirm: 
########################################
User/Group Configuration exists
########################################
TrakCare Shell Environment Configuration exists
########################################
Trak Directories
NOTE - ./do_Trak_dirs.sh not creating "/trak/schlPRD/int/hs" as it exists
NOTE - ./do_Trak_dirs.sh not creating "/trak/schlPRD/int/web" as it exists
NOTE - ./do_Trak_dirs.sh not creating "/trak/schlPRD/int//pri" as it exists
NOTE - ./do_Trak_dirs.sh not creating "/trak/schlPRD/int//alt" as it exists
NOTE - ./do_Trak_dirs.sh not creating "/trak/schlPRD/int/db" as it exists
NOTE - ./do_Trak_dirs.sh not creating "/trak/schlPRD/int/store/temp" as it exists
NOTE - ./do_Trak_dirs.sh not creating "/trak/schlPRD/int/patches" as it exists
NOTE - ./do_Trak_dirs.sh not creating "/trak/schlPRD/int/patches-completed" as it exists
NOTE - ./do_Trak_dirs.sh not creating "/trak/schlPRD/int/perforce" as it exists
########################################
Trak Permissions (basic)
########################################
Trak SMR Directories
########################################
Install Utilities
Loaded plugins: product-id, search-disabled-repos, subscription-manager
Package util-linux-2.23.2-43.el7_4.2.x86_64 already installed and latest version
Nothing to do
########################################
snmpd Configuration Exists
########################################
snmpd Configuration Exists for cacti-apache
########################################
snmpd Configuration Exists for cacti-cups
########################################
snmpd Configuration Exists for cacti-iostat
########################################
snmpd Configuration Exists for cacti-processes+
########################################
snmpd Configuration Exists for cacti-TCMon
########################################
snmpd Configuration Exists for cacti-vmstat
########################################
snmpd Configuration Exists for cacti-hugepages
########################################
Nagios nrpe Configuration Exists
########################################
Apache Configuration Exists
HealthShare
########################################
./do_HSAP2015_Install.sh: NOTE - Skipping CSP as already installed - "/opt/cspgateway/bin/CSP.ini" exists
HSAP Install for schl : PRD : INTEGRATION (SCHL2016INTEGRATION) below /trak/schlPRD/int
No files matching "HSAP-2015*-hscore*-lnxrhx64.tar.gz" in: /trak/iscbuild/trakautomation /tmp /root .. ../installers ../InstallKit ../Kit ../setup ../tools
]0;root@schl16intm1:/trak/iscbuild/trakautomation[root@schl16intm1 trakautomation]# scp -r schl16intm1tintm1eintm1sintm1tintm1[C[C[C[C[C:/trak/iscbuild/inte[Ka[K[Kstallers ../[1@i[1@n[1@t[1@e[1@r[1@0[1@2[1@@
The authenticity of host 'schl16testintm1 (10.101.3.158)' can't be established.
ECDSA key fingerprint is 7b:47:d4:c6:6c:0e:3b:95:46:b7:dc:9c:10:3f:cd:d9.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added 'schl16testintm1,10.101.3.158' (ECDSA) to the list of known hosts.
inter02@schl16testintm1's password: 
HSAP-2015.2.0.664.3.17168-hscore14.01-b1157.17168-lnxrhx64.tar.gz                  0%    0     0.0KB/s   --:-- ETAHSAP-2015.2.0.664.3.17168-hscore14.01-b1157.17168-lnxrhx64.tar.gz                 34%  275MB 274.9MB/s   00:01 ETAHSAP-2015.2.0.664.3.17168-hscore14.01-b1157.17168-lnxrhx64.tar.gz                 71%  565MB 276.4MB/s   00:00 ETAHSAP-2015.2.0.664.3.17168-hscore14.01-b1157.17168-lnxrhx64.tar.gz                100%  792MB 263.9MB/s   00:03    
T2016.2_20160422_1705_R0_SCXX_FULL_B2.zip                                          0%    0     0.0KB/s   --:-- ETAT2016.2_20160422_1705_R0_SCXX_FULL_B2.zip                                         37%  231MB 231.4MB/s   00:01 ETAT2016.2_20160422_1705_R0_SCXX_FULL_B2.zip                                         85%  524MB 237.5MB/s   00:00 ETAT2016.2_20160422_1705_R0_SCXX_FULL_B2.zip                                        100%  611MB 305.6MB/s   00:02    
]0;root@schl16intm1:/trak/iscbuild/trakautomation[root@schl16intm1 trakautomation]# scp -r inter02@schl16testintm1:/trak/iscbuild/installers ../[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[34P./MasterSCHLLive2016INT.sh

Cach√© Password to use: 
Confirm: 
########################################
User/Group Configuration exists
########################################
TrakCare Shell Environment Configuration exists
########################################
Trak Directories
NOTE - ./do_Trak_dirs.sh not creating "/trak/schlPRD/int/hs" as it exists
NOTE - ./do_Trak_dirs.sh not creating "/trak/schlPRD/int/web" as it exists
NOTE - ./do_Trak_dirs.sh not creating "/trak/schlPRD/int//pri" as it exists
NOTE - ./do_Trak_dirs.sh not creating "/trak/schlPRD/int//alt" as it exists
NOTE - ./do_Trak_dirs.sh not creating "/trak/schlPRD/int/db" as it exists
NOTE - ./do_Trak_dirs.sh not creating "/trak/schlPRD/int/db/audit" as it exists
NOTE - ./do_Trak_dirs.sh not creating "/trak/schlPRD/int/db/log" as it exists
NOTE - ./do_Trak_dirs.sh not creating "/trak/schlPRD/int/store/temp" as it exists
NOTE - ./do_Trak_dirs.sh not creating "/trak/schlPRD/int/patches" as it exists
NOTE - ./do_Trak_dirs.sh not creating "/trak/schlPRD/int/patches-completed" as it exists
NOTE - ./do_Trak_dirs.sh not creating "/trak/schlPRD/int/perforce" as it exists
########################################
Trak Permissions (basic)
########################################
Trak SMR Directories
########################################
Install Utilities
Loaded plugins: product-id, search-disabled-repos, subscription-manager
Package util-linux-2.23.2-43.el7_4.2.x86_64 already installed and latest version
Nothing to do
########################################
snmpd Configuration Exists
########################################
snmpd Configuration Exists for cacti-apache
########################################
snmpd Configuration Exists for cacti-cups
########################################
snmpd Configuration Exists for cacti-iostat
########################################
snmpd Configuration Exists for cacti-processes+
########################################
snmpd Configuration Exists for cacti-TCMon
########################################
snmpd Configuration Exists for cacti-vmstat
########################################
snmpd Configuration Exists for cacti-hugepages
########################################
Nagios nrpe Configuration Exists
########################################
Apache Configuration Exists
HealthShare
########################################
./do_HSAP2015_Install.sh: NOTE - Skipping CSP as already installed - "/opt/cspgateway/bin/CSP.ini" exists
HSAP Install for schl : PRD : INTEGRATION (SCHL2016INTEGRATION) below /trak/schlPRD/int
Found Installer: /trak/schlPRD/int/db/temp/isc_coding/installers/HSAP-2015.2.0.664.3.17168-hscore14.01-b1157.17168-lnxrhx64.tar.gz
depends
NOTE - ./do_HSAP2015_Install.sh not creating "/trak/schlPRD/int/hs" as it exists
NOTE - ./do_HSAP2015_Install.sh not creating "/trak/schlPRD/int/db" as it exists
NOTE - no WIJ directory found
installing Cache now
Installing without CSP
spawn ./cinstall

Your system type is 'Red Hat Enterprise Linux (x64)'.

Currently defined instances:


Enter instance name: SCHL2016INTEGRATION
Do you want to create HealthShare instance 'SCHL2016INTEGRATION' <Yes>? 
Enter a destination directory for the new instance.
Directory: /trak/schlPRD/int/hs

----------------------------------------------------
NOTE: Users should not attempt to access HealthShare while
      the installation is in progress.
----------------------------------------------------


Disk blocks required  = 3755292
Disk blocks available = 52337312

How restrictive do you want the initial Security settings to be?
"Normal" is less restrictive, "Locked Down" is the most secure.
    1) Normal
    2) Locked Down
Initial Security settings <1>? 1

What user should be the owner of this instance? cachesys
A Cache account will also be created for user cachesys.

Install will create the following HealthShare accounts for you: 
_SYSTEM, Admin, SuperUser, cachesys and CSPSystem. 
Please enter the common password for _SYSTEM, Admin, SuperUser and cachesys: 
Re-enter the password to confirm it: 

Please enter the password for CSPSystem: 
Re-enter the password to confirm it: 

What group should be allowed to start and stop
  this instance? cachemgr

Do you want to configure additional security options <No>? y

What is the effective group for HealthShare processes <cacheusr>? cachegrp

What is the effective user for the Cache SuperServer
  and its jobs <cacheusr>? cacheusr

Do you want to load the Manager utility source code <Yes>? 

Enter the SuperServer port number <1972>: 

Enter the WebServer port number <57772>: 

Do you want to configure the CSP Gateway to use an existing web server <No>? n

Cache did not detect a license key
in directory /trak/schlPRD/int/hs/mgr.
Do you want to enter a license key <No>? 

Client component selection

   [ ]    1) C++ binding
   [ ]    2) C++ SDK
   [ ]    3) Perl binding
   [ ]    4) Python binding
   [ ]    5) HealthShare engine link libraries (callin/callout)
   [ ]    6) Light C++ binding
          +) Select all

Enter the number of each component you wish to install.
Enter the number of an already selected component to deselect it.
Multiple selections can be separated by spaces.
Enter a blank line to continue.
> +
Selecting all...

Client component selection

   [*]    1) C++ binding
   [*]    2) C++ SDK
   [*]    3) Perl binding
   [*]    4) Python binding
   [*]    5) HealthShare engine link libraries (callin/callout)
   [*]    6) Light C++ binding
          +) Select all

Enter the number of each component you wish to install.
Enter the number of an already selected component to deselect it.
Multiple selections can be separated by spaces.
Enter a blank line to continue.
> 

HealthShare component selection

   [*]    1) Database and Integration Environment
   [*]    2) Linkage Engine
   [*]    3) HealthShare Core Components
          +) Select all

"*" indicated that a component is selected.
Enter the number of an already selected component to deselect it.
Enter the number of a deselected component to select it.
Multiple selections can be separated by spaces.
Enter a blank line to continue.
> +
Selecting all...
Selecting 1
Selecting 2
Selecting 3

HealthShare component selection

   [*]    1) Database and Integration Environment
   [*]    2) Linkage Engine
   [*]    3) HealthShare Core Components
          +) Select all

"*" indicated that a component is selected.
Enter the number of an already selected component to deselect it.
Enter the number of a deselected component to select it.
Multiple selections can be separated by spaces.
Enter a blank line to continue.
> 

Please review the installation options:
------------------------------------------------------------------
Instance name: SCHL2016INTEGRATION
Destination directory: /trak/schlPRD/int/hs
HealthShare version to install: 2015.2.0.664.3.17168
Installation type: Custom
Unicode support: Y
Initial Security settings: Normal
User who owns instance: cachesys
Group allowed to start and stop instance: cachemgr
Effective group for HealthShare processes: cachegrp
Effective user for HealthShare SuperServer: cacheusr
SuperServer port: 1972
WebServer port: 57772
JDBC Gateway port: 62972
CSP Gateway: using built-in web server
Client components:
   ODBC client
   C++ binding
   Perl binding
   Python binding
   HealthShare engine link libraries
   Light C++ binding
------------------------------------------------------------------

Do you want to proceed with the installation <Yes>? 

Starting installation...

Starting up HealthShare for loading...
../bin/cinstall -s . -B -c c -C /trak/schlPRD/int/hs/cache.cpf*SCHL2016INTEGRATION -W 1 -g2 
Starting Control Process
Allocated 97MB shared memory: 2MB global buffers, 35MB routine buffers
Cache startup successful.
System locale setting is 'en_GB.UTF-8'
This copy of Cache has been licensed for use exclusively by:
License missing or unreadable.
Copyright (c) 1986-2017 by InterSystems Corporation
Any other use is a violation of your license agreement

^^/trak/schlPRD/int/hs/mgr/>

^^/trak/schlPRD/int/hs/mgr/>
Start of Cache initialization

Loading system routines


Updating Cachetemp and Cache database

Installing National Language support

Loading system classes

Updating Security database

Loading system source code


Building system indices

Updating Audit database

Updating Journal directory

Updating User database

Updating Ensemble databases
Load started on 03/27/2018 10:18:33
Loading file /tmp/cacheextract/dist/install/misc/hsutil.xml as xml
Imported class: %ZHSLIB.Audit.Log
Imported class: %ZHSLIB.Audit.LogParticipant
Imported class: %ZHSLIB.Component
Imported class: %ZHSLIB.HealthShareMgr
Imported class: %ZHSLIB.Services.Client
Imported class: %ZHSLIB.Services.NVPair
Imported class: %ZHSLIB.Services.Server
Imported class: %ZHSLIB.Services.TaskCalculateUpdatedRAndR
Imported class: %ZHSLIB.Services.TaskUpdateRolesAndResources
Imported class: %ZHSLIB.SessionEventUtil
Imported class: %ZHSLIB.UserChangePassword
Imported class: %ZHSLIB.UserLogin
Imported class: %ZHSLIB.UsersAndRoles
Imported routine: %ZHSLIB.INC
Imported routine: %ZJRNPURGE.MAC, compiling 13 classes, using 2 worker jobs
Compiling class %ZHSLIB.Audit.Log
Compiling class %ZHSLIB.HealthShareMgr
Compiling class %ZHSLIB.Services.Client
Compiling class %ZHSLIB.Services.NVPair
Compiling class %ZHSLIB.Services.Server
Compiling class %ZHSLIB.Services.TaskCalculateUpdatedRAndR
Compiling class %ZHSLIB.Services.TaskUpdateRolesAndResources
Compiling class %ZHSLIB.SessionEventUtil
Compiling class %ZHSLIB.UserChangePassword
Compiling class %ZHSLIB.UserLogin
Compiling class %ZHSLIB.UsersAndRoles
Compiling class %ZHSLIB.Audit.LogParticipant
Compiling table %ZHSLIB_Audit.Log
Compiling table %ZHSLIB_Audit.LogParticipant
Compiling routine %ZHSLIB.Audit.Log.1
Compiling routine %ZHSLIB.HealthShareMgr.1
Compiling routine %ZHSLIB.Services.Client.1
Compiling routine %ZHSLIB.Services.NVPair.1
Compiling routine %ZHSLIB.Services.Server.1
Compiling routine %ZHSLIB.Services.TaskCalculateUpdatedRAndR.1
Compiling routine %ZHSLIB.Services.TaskUpdateRolesAndResources.1
Compiling routine %ZHSLIB.SessionEventUtil.1
Compiling routine %ZHSLIB.UserChangePassword.1
Compiling routine %ZHSLIB.UserLogin.1
Compiling routine %ZHSLIB.UsersAndRoles.1
Compiling routine %ZHSLIB.Audit.LogParticipant.1
Compiling class %ZHSLIB.Component
Compiling routine %ZHSLIB.Component.1
Compiling class %ZHSLIB.Services.Client.GetNVPair
Compiling class %ZHSLIB.Services.Server.GetNVPair
Compiling routine %ZHSLIB.Services.Client.GetNVPair.1
Compiling routine %ZHSLIB.Services.Server.GetNVPair.1
Compiling routine : %ZJRNPURGE.MAC
Load finished successfully.


Scheduling inventory scan

Cache initialization complete

See the cboot.log file for a record of the installation.

Starting up HealthShare...
Once this completes, users may access HealthShare
Starting SCHL2016INTEGRATION
using 'cache.cpf' configuration file

Starting Control Process
Automatically configuring buffers
Allocated 634MB shared memory: 256MB global buffers, 300MB routine buffers
Creating a WIJ file to hold 31 megabytes of data
This copy of Cache has been licensed for use exclusively by:
License missing or unreadable.
Copyright (c) 1986-2017 by InterSystems Corporation
Any other use is a violation of your license agreement

1 alert(s) during startup. See cconsole.log for details.


You can point your browser to http://schl16intm1.nhsh.scot.nhs.uk:57772/csp/sys/UtilHome.csp
to access the management portal.

Installation completed successfully
spawn su - cacheusr -c csession SCHL2016INTEGRATION

Node: schl16intm1.nhsh.scot.nhs.uk, Instance: SCHL2016INTEGRATION

Username: SuperUser
Password: **************
USER>zn "%SYS"

%SYS>do $system.OBJ.Load("/trak/iscbuild/trakautomation/conffiles/ZSTU.xml","ck")

Load started on 03/27/2018 10:19:19
Loading file /trak/iscbuild/trakautomation/conffiles/ZSTU.xml as xml
Imported routine: ZSTU.MAC
Compiling routine : ZSTU.MAC
Load finished successfully.

%SYS>
NOTE - Instance SCHL2016INTEGRATION has not been added to /etc/init.d/isccache to start at boot
########################################
Installing licenses...
/trak/iscbuild/trakautomation/cache.key
Installing license for /trak/schlPRD/int/hs/mgr
########################################
Configuring Environment SCHL2016INTEGRATION
Environment Configuration for schl : PRD (SCHL2016INTEGRATION)
Pri Journal /trak/schlPRD/int/jrn/pri/
Alt Journal /trak/schlPRD/int/jrn/alt/

10:19:19 Shutting down Cache
10:19:19 Notifying Clients
10:19:19 No user shutdown routines to execute
10:19:19 Stopping User Jobs
10:19:19 Stopping Network Servers
10:19:19 Withdrawing from License Domain
10:19:19 Waiting for users to stop
10:19:19 Stopping Client Networking
10:19:19 Removing database locks
10:19:19 Updating Journal File
10:19:20 Waiting for database updates to complete
10:19:20 Database updates complete
10:19:20 Stopping System Jobs
10:19:22 Shutdown complete
Starting SCHL2016INTEGRATION
using 'cache.cpf' configuration file

Starting Control Process
Allocated 12352MB shared memory: 10668MB global buffers, 1000MB routine buffers
Creating a WIJ file to hold 49 megabytes of data
This copy of Cache has been licensed for use exclusively by:
ISC TrakCare Development
Copyright (c) 1986-2017 by InterSystems Corporation
Any other use is a violation of your license agreement

########################################
zCustom.SnapBackup Install for schl : PRD (SCHL2016INTEGRATION)
Found Class: /trak/schlPRD/int/db/temp/isc_coding/trakautomation/zCustom.SnapBackup/zCustom.SnapBackup-20131212.xml
Found Call-in: /trak/schlPRD/int/db/temp/isc_coding/trakautomation/zCustom.SnapBackup/zCustom.SnapBackup.sh
Found snaplib: /trak/schlPRD/int/db/temp/isc_coding/trakautomation/zCustom.SnapBackup/snaplib.sh
spawn su - cacheusr -c csession SCHL2016INTEGRATION

Node: schl16intm1.nhsh.scot.nhs.uk, Instance: SCHL2016INTEGRATION

Username: SuperUser
Password: **************
USER>zn "%SYS"

%SYS>write ##class(Security.Users).Exists("cachebackup")
0
%SYS>d ##Class(Security.Users).Create("cachebackup","%ALL","","Cache Backup user","","","",0,1,"",1,"","","",1,1)

%SYS>do ^SECURITY


1) User setup
2) Role setup
3) Service setup
4) Resource setup
5) Application setup
6) Auditing setup
7) Domain setup
8) SSL configuration setup
9) Mobile phone service provider setup
10) OpenAM Identity Services setup
11) Encryption key setup
12) System parameter setup
13) X509 User setup
14) Exit

Option? 12

1) Edit system options
2) Edit authentication options
3) Edit LDAP options
4) Display system options
5) Export All Security settings
6) Import All Security settings
7) Exit

Option? 2
Allow Unauthenticated access? Yes => Yes
Allow Operating System authentication? No => Yes
Allow Delegated Authorization for O/S authentication? No => No
Allow Password authentication? Yes => Yes
Allow Delegated authentication? Yes => Yes
Allow Kerberos authentication? Yes => Yes
Allow Delegated Authorization for Kerberos authentication? No => No
Allow LDAP authentication? No => No
Use Login Cookies? No => No
Allow Two-factor Time-based One-time Password authentication? No => No
Allow Two-factor SMS authentication? No => No

Confirm changes to authentication options? Yes => Yes
Authentication options updated

1) Edit system options
2) Edit authentication options
3) Edit LDAP options
4) Display system options
5) Export All Security settings
6) Import All Security settings
7) Exit

Option? 

1) User setup
2) Role setup
3) Service setup
4) Resource setup
5) Application setup
6) Auditing setup
7) Domain setup
8) SSL configuration setup
9) Mobile phone service provider setup
10) OpenAM Identity Services setup
11) Encryption key setup
12) System parameter setup
13) X509 User setup
14) Exit

Option? 3

1) Edit service
2) List services
3) Detailed list services
4) Export services
5) Import services
6) Exit

Option? 1

Service to edit? %Service_Terminal
Enabled? Yes => Yes
Allow Unauthenticated access? No => No
Allow Operating System authentication? Yes => Yes
Allow Password authentication? Yes => Yes
Allow Kerberos authentication? No => No
Allow Kerberos Credentials Cache authentication? No => No
Confirm changes to service %Service_Terminal? Yes => Yes
Service %Service_Terminal updated

Service to edit? 

1) Edit service
2) List services
3) Detailed list services
4) Export services
5) Import services
6) Exit

Option? 

1) User setup
2) Role setup
3) Service setup
4) Resource setup
5) Application setup
6) Auditing setup
7) Domain setup
8) SSL configuration setup
9) Mobile phone service provider setup
10) OpenAM Identity Services setup
11) Encryption key setup
12) System parameter setup
13) X509 User setup
14) Exit

Option? 
%SYS>do $system.OBJ.Load("/trak/schlPRD/int/db/temp/isc_coding/trakautomation/zCustom.SnapBackup/zCustom.SnapBackup-20131212.xml","ck")

Load started on 03/27/2018 10:19:54
Loading file /trak/schlPRD/int/db/temp/isc_coding/trakautomation/zCustom.SnapBackup/zCustom.SnapBackup-20131212.xml as xml
Imported class: zCustom.SnapBackup
Compiling class zCustom.SnapBackup
Compiling routine zCustom.SnapBackup.1
Load finished successfully.

%SYS>
########################################
zCustom.TrakCareCustomTasks Install for schl : PRD (SCHL2016INTEGRATION)
Found Class: /trak/schlPRD/int/db/temp/isc_coding/trakautomation/zCustom.TrakCareCustomTasks/zCustom.TrakCareCustomTasks.xml
spawn su - cacheusr -c csession SCHL2016INTEGRATION

Node: schl16intm1.nhsh.scot.nhs.uk, Instance: SCHL2016INTEGRATION

Username: SuperUser
Password: **************
USER>zn "SCHL-PRD"

ZN "SCHL-PRD"
^
<NAMESPACE>
USER>zn "SCHL-PRD" do $system.OBJ.Load("/trak/schlPRD/int/db/temp/isc_coding/trakautomation/zCustom.TrakCareCustomTasks/zCustom.TrakCareCustomTasks.xml","fck") zn "SCHL-PRD"

ZN "SCHL-PRD" DO $SYSTEM.OBJ.Load("/trak/schlPRD/int/db/temp/isc_coding/trakauto
^
mation/zCustom.TrakCareCustomTasks/zCustom.TrakCareCustomTasks.xml","fck") ZN "S
CHL-PRD"
<NAMESPACE>
USER>h

^C]0;root@schl16intm1:/trak/iscbuild/trakautomation[root@schl16intm1 trakautomation]# ./MasterSCHLLive2016INT.shv./MasterSCHLLive2016INT.shi./MasterSCHLLive2016INT.sh ./MasterSCHLLive2016INT.sh
[?1049h[?1h=[1;40r[?12;25h[?12l[?25h[27m[m[H[2J[?25l[40;1H"./MasterSCHLLive2016INT.sh" 143L, 3840C[1;1H#!/bin/sh -e
# This is an example master script using the tools created
# It expects HSAP-*.tar.gz to be in the same directory
export TMPDIR=/trak/iscbuild/tmp
export SITE=schl
export ENV=PRD
export VER=2016
export TYPE=INTEGRATION
MONITORIP=10.20.0.12
#
# Various overrides exist to allow customisation of behaviour
# This section details those overrides
#
#
# Add custom enironment names - used in functions.sh
#export EXTRAENVS=UPGRADE
#
# Force a custom base path - used for non-standard paths. Expect hs*/ db/ web/ etc. below this
export TRAKROOT=/trak/schlPRD/int
#
# Set custom Users/Groups TODO this is largely untested - use with due caution
# Setting usersnames/groupnames to "!" disables them, but take care since it will break if they are actually needed[23;1Hexport CACHEUSR=cacheusr
export CACHEUSRID=2001
export TRAKSMB=!
export TRAKSMBID=3001
export CACHEBACKUP=cachebackup
export CACHEBACKUPID=2003
export CACHESYSUSR=cachesys
export CACHESYSUSRID=2002

export CACHEGRP=cachegrp
export CACHEGRPID=2001
export CACHEMGR=cachemgr
export CACHEMGRID=2002
export TRAKCACHE=!
export TRAKCACHEID=3002
export TRAKPRINT=cupsAdministrator
export TRAKPRINTID=2003[1;1H[?12l[?25h[?25l[27m[m[H[2J[1;1Hexport TRAKPRINT=cupsAdministrator
export TRAKPRINTID=2003

# bring in functions and defaults - this must be first!
. ./functions.sh
checkvars

# check for Package source
#./do_PackageCheck.sh

# check we are root
./do_rootCheck.sh

# check we have basic Perl available
./do_PerlCheck.sh

# pick up passwords if available (eg. test systems) else prompt
if [ -f /tmp/testcredentials ]; then[19;9H# this should just be shell code exporting CACHEPASS and TRAKZIPPASS[20;9H. /tmp/testcredentials
else[22;9Hecho[23;9H# read in password for Cach√© - this will be inherited by all Cach√© installs in this script[24;9Hgetpass "Cach√© Password to use" CACHEPASS
fi
export TRAKZIPPASS="not needed"

# disable SELINUX
#./do_SELINUXdisable.sh

# set users/groups
./do_Users.sh

# stop messing about with Cach√© Terminal from wrong users
./do_UserEnv.sh

# Trak Directories
./do_Trak_dirs.sh[1;1H[?12l[?25h[?25l[27m[m[H[2J[1;1H./do_Trak_dirs.sh

# SMR dirs - Scotland only
./do_TrakSMR_dirs.sh

# install standard utilities
./do_Utilities.sh

# snmpd
./do_SNMP.sh $MONITORIP

# cacti template config
./do_cacti_snmp.sh cacti-apache
./do_cacti_snmp.sh cacti-cups
./do_cacti_snmp.sh cacti-iostat
./do_cacti_snmp.sh cacti-processes+
./do_cacti_snmp.sh cacti-TCMon
./do_cacti_snmp.sh cacti-vmstat
./do_cacti_snmp.sh cacti-hugepages

# nagios
# IMPORTANT - this is not on the RH DVD so will install RPMs from RPMForge
# This is also not fully implimented (auto thershold calculation) so needs manually editing after install
./do_nagios-nrpe.sh $MONITORIP DB,PRT,WEB TODO-licenses TODO-episodes

# apache
./do_apache.sh
./do_apacheTune.sh

# samba
#./do_samba.sh WORKGROUP `hostname | cut -d. -f1` "Test Server" $SITE_UC

# install HS
echo HealthShare
./do_HSAP2015_Install.sh $SITE $ENV $TYPE$VER

# install license keys - without args does this for all instances found
./do_Environment_key.sh[1;1H[?12l[?25h[?25l[27m[m[H[2J[1;1H./do_Environment_key.sh

# set HS config
# Usage: ./do_Environment_config.sh
# <Site Code> <Environment> <Type>[Version] <routine buffers in MiB> <global buffers in MiB> <lock table size in B>>[6;1H <gmheap in kiB>
# 1000MB 10668MB 16MB 128MB
./do_Environment_config.sh $SITE $ENV $TYPE$VER 1000 10668 16777216 131072

# printing & preview
#./do_CUPS.sh
#./do_FOPConf.sh $SITE $ENV $TYPE$VER 128m 128m

# do Trak install
#./do_TrakVanillaT2016_Install.sh
#./do_TrakCare2016_ApacheCSP.sh $TYPE

# load in specific tools we need - NOTE: these will probably fail without licenses in place
#./do_zCustom.CheckSNMP_Install.sh $TYPE
./do_zCustom.SnapBackup_Install.sh $TYPE

# SysAdminTasks (was TrakCareCustomTasks) / TCMon Stuff
./do_zCustom.TrakCareCustomTasks_Install.sh $TYPE

# Huge Pages configuration
./do_hugePages.sh 6700

# set to auto-start
./do_SetAutostart.sh

echo
echo Probably worth rebooting to ensure no memory fragmentation and test the config...

[1m[34m~                                                                                                                  [35;1H~                                                                                                                  [36;1H~                                                                                                                  [37;1H~                                                                                                                  [38;1H~                                                                                                                  [39;1H~                                                                                                                  [1;1H[?12l[?25h





















[?25l[m[40;1H[1m-- INSERT --[23;1H[?12l[?25h[?25l[m#./do_zCustom.TrakCareCustomTasks_Install.sh $TYPE#[?12l[?25h[40;1H[K[23;1H[?25l[?12l[?25h[?25l[40;1H:[?12l[?25hx[?25l"./MasterSCHLLive2016INT.sh" 143L, 3841C written
[?1l>[?12l[?25h[?1049l]0;root@schl16intm1:/trak/iscbuild/trakautomation[root@schl16intm1 trakautomation]# vi ./MasterSCHLLive2016INT.sh[3P./MasterSCHLLive2016INT.sh

Cach√© Password to use: 
Confirm: 
########################################
User/Group Configuration exists
########################################
TrakCare Shell Environment Configuration exists
########################################
Trak Directories
NOTE - ./do_Trak_dirs.sh not creating "/trak/schlPRD/int/hs" as it exists
NOTE - ./do_Trak_dirs.sh not creating "/trak/schlPRD/int/web" as it exists
NOTE - ./do_Trak_dirs.sh not creating "/trak/schlPRD/int//pri" as it exists
NOTE - ./do_Trak_dirs.sh not creating "/trak/schlPRD/int//alt" as it exists
NOTE - ./do_Trak_dirs.sh not creating "/trak/schlPRD/int/db" as it exists
NOTE - ./do_Trak_dirs.sh not creating "/trak/schlPRD/int/db/audit" as it exists
NOTE - ./do_Trak_dirs.sh not creating "/trak/schlPRD/int/db/log" as it exists
NOTE - ./do_Trak_dirs.sh not creating "/trak/schlPRD/int/store/temp" as it exists
NOTE - ./do_Trak_dirs.sh not creating "/trak/schlPRD/int/patches" as it exists
NOTE - ./do_Trak_dirs.sh not creating "/trak/schlPRD/int/patches-completed" as it exists
NOTE - ./do_Trak_dirs.sh not creating "/trak/schlPRD/int/perforce" as it exists
########################################
Trak Permissions (basic)
########################################
Trak SMR Directories
########################################
Install Utilities
Loaded plugins: product-id, search-disabled-repos, subscription-manager
Package util-linux-2.23.2-43.el7_4.2.x86_64 already installed and latest version
Nothing to do
########################################
snmpd Configuration Exists
########################################
snmpd Configuration Exists for cacti-apache
########################################
snmpd Configuration Exists for cacti-cups
########################################
snmpd Configuration Exists for cacti-iostat
########################################
snmpd Configuration Exists for cacti-processes+
########################################
snmpd Configuration Exists for cacti-TCMon
########################################
snmpd Configuration Exists for cacti-vmstat
########################################
snmpd Configuration Exists for cacti-hugepages
########################################
Nagios nrpe Configuration Exists
########################################
Apache Configuration Exists
HealthShare
########################################
./do_HSAP2015_Install.sh: NOTE - Skipping CSP as already installed - "/opt/cspgateway/bin/CSP.ini" exists
HSAP Install for schl : PRD : INTEGRATION (SCHL2016INTEGRATION) below /trak/schlPRD/int
Found Installer: /trak/schlPRD/int/db/temp/isc_coding/installers/HSAP-2015.2.0.664.3.17168-hscore14.01-b1157.17168-lnxrhx64.tar.gz
depends
Instance already exists - skipping
########################################
Installing licenses...
/trak/iscbuild/trakautomation/cache.key
Installing license for /trak/schlPRD/int/hs/mgr
########################################
Configuring Environment SCHL2016INTEGRATION
Environment Configuration for schl : PRD (SCHL2016INTEGRATION)
Already configured... skipping
########################################
zCustom.SnapBackup Install for schl : PRD (SCHL2016INTEGRATION)
Found Class: /trak/schlPRD/int/db/temp/isc_coding/trakautomation/zCustom.SnapBackup/zCustom.SnapBackup-20131212.xml
Found Call-in: /trak/schlPRD/int/db/temp/isc_coding/trakautomation/zCustom.SnapBackup/zCustom.SnapBackup.sh
Found snaplib: /trak/schlPRD/int/db/temp/isc_coding/trakautomation/zCustom.SnapBackup/snaplib.sh
spawn su - cacheusr -c csession SCHL2016INTEGRATION

Node: schl16intm1.nhsh.scot.nhs.uk, Instance: SCHL2016INTEGRATION

Username: SuperUser
Password: ***********
Access Denied

Username: ^C]0;root@schl16intm1:/trak/iscbuild/trakautomation[root@schl16intm1 trakautomation]# ^C
]0;root@schl16intm1:/trak/iscbuild/trakautomation[root@schl16intm1 trakautomation]# ^C
]0;root@schl16intm1:/trak/iscbuild/trakautomation[root@schl16intm1 trakautomation]# ^C
]0;root@schl16intm1:/trak/iscbuild/trakautomation[root@schl16intm1 trakautomation]# ^C
]0;root@schl16intm1:/trak/iscbuild/trakautomation[root@schl16intm1 trakautomation]# ^C
]0;root@schl16intm1:/trak/iscbuild/trakautomation[root@schl16intm1 trakautomation]# ccontrol all
    Instance Name     Version ID        Port   Directory
    ----------------  ----------------  -----  --------------------------------
up  SCHL2016INTEGRAT  2015.2.0.664.3.1  1972   /trak/schlPRD/int/hs
    ION               7168
]0;root@schl16intm1:/trak/iscbuild/trakautomation[root@schl16intm1 trakautomation]# ccontrol stop SCHL2016INTEGRATION

                  Cache Shutdown Status: 10:23 am 27 Mar 2018

       0 interactive jobs (Telnet/Lat)
       0 background jobs (from job command)
       0 Cache Direct server jobs
       0 CSP server jobs
       0 ODBC server jobs
      19 system jobs

Do you want to broadcast a message to anyone? No => No
Do you want to see the Cache status report? No => No
Do you want to run the user defined shutdown routine? Yes => Yes
Are you ready for the system to halt? Yes => Yes

10:23:22 Shutting down Cache
10:23:22 Notifying Clients
10:23:22 No user shutdown routines to execute
10:23:22 Stopping User Jobs
10:23:22 Stopping Network Servers
10:23:22 Withdrawing from License Domain
10:23:22 Waiting for users to stop
10:23:22 Stopping Client Networking
10:23:22 Removing database locks
10:23:22 Updating Journal File
10:23:24 Waiting for database updates to complete
10:23:24 Database updates complete
10:23:24 Stopping System Jobs
10:23:25 Shutdown complete
]0;root@schl16intm1:/trak/iscbuild/trakautomation[root@schl16intm1 trakautomation]# ccontrol delelte [K[K[K[K[Kete SCHL2016INTEGRATION
]0;root@schl16intm1:/trak/iscbuild/trakautomation[root@schl16intm1 trakautomation]# dm[K[Krm -rf /trak/schlPRD/int/hs/*
]0;root@schl16intm1:/trak/iscbuild/trakautomation[root@schl16intm1 trakautomation]# ls -la /trak/schlPRD/int/hs/[K[K[Kdb/
total 0
drwxr-xr-x  5 cacheusr cachegrp  42 Mar 27 10:14 [0m[01;34m.[0m
drwxr-xr-x 12 root     root     139 Mar 27 09:33 [01;34m..[0m
drwxr-xr-x  2 cacheusr cachegrp   6 Mar 27 10:14 [01;34maudit[0m
drwxr-xr-x  2 cacheusr cachegrp   6 Mar 27 10:14 [01;34mlog[0m
drwxr-xr-x  3 cacheusr cachegrp  24 Mar 27 10:08 [01;34mtemp[0m
]0;root@schl16intm1:/trak/iscbuild/trakautomation[root@schl16intm1 trakautomation]# [13P(reverse-i-search)`':[CM': ./MasterSCHLLive2016INT.sh[1@a[C[C[C[C[C[1@s[C[C[C[C[C[10@[root@schl16intm1 trakautomation]#[C[C[C

Cach√© Password to use: 
Confirm: 
########################################
User/Group Configuration exists
########################################
TrakCare Shell Environment Configuration exists
########################################
Trak Directories
NOTE - ./do_Trak_dirs.sh not creating "/trak/schlPRD/int/hs" as it exists
NOTE - ./do_Trak_dirs.sh not creating "/trak/schlPRD/int/web" as it exists
NOTE - ./do_Trak_dirs.sh not creating "/trak/schlPRD/int//pri" as it exists
NOTE - ./do_Trak_dirs.sh not creating "/trak/schlPRD/int//alt" as it exists
NOTE - ./do_Trak_dirs.sh not creating "/trak/schlPRD/int/db" as it exists
NOTE - ./do_Trak_dirs.sh not creating "/trak/schlPRD/int/db/audit" as it exists
NOTE - ./do_Trak_dirs.sh not creating "/trak/schlPRD/int/db/log" as it exists
NOTE - ./do_Trak_dirs.sh not creating "/trak/schlPRD/int/store/temp" as it exists
NOTE - ./do_Trak_dirs.sh not creating "/trak/schlPRD/int/patches" as it exists
NOTE - ./do_Trak_dirs.sh not creating "/trak/schlPRD/int/patches-completed" as it exists
NOTE - ./do_Trak_dirs.sh not creating "/trak/schlPRD/int/perforce" as it exists
########################################
Trak Permissions (basic)
########################################
Trak SMR Directories
########################################
Install Utilities
Loaded plugins: product-id, search-disabled-repos, subscription-manager
Package util-linux-2.23.2-43.el7_4.2.x86_64 already installed and latest version
Nothing to do
########################################
snmpd Configuration Exists
########################################
snmpd Configuration Exists for cacti-apache
########################################
snmpd Configuration Exists for cacti-cups
########################################
snmpd Configuration Exists for cacti-iostat
########################################
snmpd Configuration Exists for cacti-processes+
########################################
snmpd Configuration Exists for cacti-TCMon
########################################
snmpd Configuration Exists for cacti-vmstat
########################################
snmpd Configuration Exists for cacti-hugepages
########################################
Nagios nrpe Configuration Exists
########################################
Apache Configuration Exists
HealthShare
########################################
./do_HSAP2015_Install.sh: NOTE - Skipping CSP as already installed - "/opt/cspgateway/bin/CSP.ini" exists
HSAP Install for schl : PRD : INTEGRATION (SCHL2016INTEGRATION) below /trak/schlPRD/int
Found Installer: /trak/schlPRD/int/db/temp/isc_coding/installers/HSAP-2015.2.0.664.3.17168-hscore14.01-b1157.17168-lnxrhx64.tar.gz
depends
NOTE - ./do_HSAP2015_Install.sh not creating "/trak/schlPRD/int/hs" as it exists
NOTE - ./do_HSAP2015_Install.sh not creating "/trak/schlPRD/int/db" as it exists
NOTE - no WIJ directory found
installing Cache now
Installing without CSP
spawn ./cinstall

Your system type is 'Red Hat Enterprise Linux (x64)'.

Currently defined instances:


Enter instance name: SCHL2016INTEGRATION
Do you want to create HealthShare instance 'SCHL2016INTEGRATION' <Yes>? 
Enter a destination directory for the new instance.
Directory: /trak/schlPRD/int/hs

----------------------------------------------------
NOTE: Users should not attempt to access HealthShare while
      the installation is in progress.
----------------------------------------------------


Disk blocks required  = 3755292
Disk blocks available = 52337312

How restrictive do you want the initial Security settings to be?
"Normal" is less restrictive, "Locked Down" is the most secure.
    1) Normal
    2) Locked Down
Initial Security settings <1>? 1

What user should be the owner of this instance? cachesys
A Cache account will also be created for user cachesys.

Install will create the following HealthShare accounts for you: 
_SYSTEM, Admin, SuperUser, cachesys and CSPSystem. 
Please enter the common password for _SYSTEM, Admin, SuperUser and cachesys: 
Re-enter the password to confirm it: 

Please enter the password for CSPSystem: 
Re-enter the password to confirm it: 

What group should be allowed to start and stop
  this instance? cachemgr

Do you want to configure additional security options <No>? y

What is the effective group for HealthShare processes <cacheusr>? cachegrp

What is the effective user for the Cache SuperServer
  and its jobs <cacheusr>? cacheusr

Do you want to load the Manager utility source code <Yes>? 

Enter the SuperServer port number <1972>: 

Enter the WebServer port number <57772>: 

Do you want to configure the CSP Gateway to use an existing web server <No>? n

Cache did not detect a license key
in directory /trak/schlPRD/int/hs/mgr.
Do you want to enter a license key <No>? 

Client component selection

   [ ]    1) C++ binding
   [ ]    2) C++ SDK
   [ ]    3) Perl binding
   [ ]    4) Python binding
   [ ]    5) HealthShare engine link libraries (callin/callout)
   [ ]    6) Light C++ binding
          +) Select all

Enter the number of each component you wish to install.
Enter the number of an already selected component to deselect it.
Multiple selections can be separated by spaces.
Enter a blank line to continue.
> +
Selecting all...

Client component selection

   [*]    1) C++ binding
   [*]    2) C++ SDK
   [*]    3) Perl binding
   [*]    4) Python binding
   [*]    5) HealthShare engine link libraries (callin/callout)
   [*]    6) Light C++ binding
          +) Select all

Enter the number of each component you wish to install.
Enter the number of an already selected component to deselect it.
Multiple selections can be separated by spaces.
Enter a blank line to continue.
> 

HealthShare component selection

   [*]    1) Database and Integration Environment
   [*]    2) Linkage Engine
   [*]    3) HealthShare Core Components
          +) Select all

"*" indicated that a component is selected.
Enter the number of an already selected component to deselect it.
Enter the number of a deselected component to select it.
Multiple selections can be separated by spaces.
Enter a blank line to continue.
> +
Selecting all...
Selecting 1
Selecting 2
Selecting 3

HealthShare component selection

   [*]    1) Database and Integration Environment
   [*]    2) Linkage Engine
   [*]    3) HealthShare Core Components
          +) Select all

"*" indicated that a component is selected.
Enter the number of an already selected component to deselect it.
Enter the number of a deselected component to select it.
Multiple selections can be separated by spaces.
Enter a blank line to continue.
> 

Please review the installation options:
------------------------------------------------------------------
Instance name: SCHL2016INTEGRATION
Destination directory: /trak/schlPRD/int/hs
HealthShare version to install: 2015.2.0.664.3.17168
Installation type: Custom
Unicode support: Y
Initial Security settings: Normal
User who owns instance: cachesys
Group allowed to start and stop instance: cachemgr
Effective group for HealthShare processes: cachegrp
Effective user for HealthShare SuperServer: cacheusr
SuperServer port: 1972
WebServer port: 57772
JDBC Gateway port: 62972
CSP Gateway: using built-in web server
Client components:
   ODBC client
   C++ binding
   Perl binding
   Python binding
   HealthShare engine link libraries
   Light C++ binding
------------------------------------------------------------------

Do you want to proceed with the installation <Yes>? 

Starting installation...

Starting up HealthShare for loading...
../bin/cinstall -s . -B -c c -C /trak/schlPRD/int/hs/cache.cpf*SCHL2016INTEGRATION -W 1 -g2 
Starting Control Process
Allocated 97MB shared memory: 2MB global buffers, 35MB routine buffers
Cache startup successful.
System locale setting is 'en_GB.UTF-8'
This copy of Cache has been licensed for use exclusively by:
License missing or unreadable.
Copyright (c) 1986-2017 by InterSystems Corporation
Any other use is a violation of your license agreement

^^/trak/schlPRD/int/hs/mgr/>

^^/trak/schlPRD/int/hs/mgr/>
Start of Cache initialization

Loading system routines


Updating Cachetemp and Cache database

Installing National Language support

Loading system classes

Updating Security database

Loading system source code


Building system indices

Updating Audit database

Updating Journal directory

Updating User database

Updating Ensemble databases
Load started on 03/27/2018 10:25:51
Loading file /tmp/cacheextract/dist/install/misc/hsutil.xml as xml
Imported class: %ZHSLIB.Audit.Log
Imported class: %ZHSLIB.Audit.LogParticipant
Imported class: %ZHSLIB.Component
Imported class: %ZHSLIB.HealthShareMgr
Imported class: %ZHSLIB.Services.Client
Imported class: %ZHSLIB.Services.NVPair
Imported class: %ZHSLIB.Services.Server
Imported class: %ZHSLIB.Services.TaskCalculateUpdatedRAndR
Imported class: %ZHSLIB.Services.TaskUpdateRolesAndResources
Imported class: %ZHSLIB.SessionEventUtil
Imported class: %ZHSLIB.UserChangePassword
Imported class: %ZHSLIB.UserLogin
Imported class: %ZHSLIB.UsersAndRoles
Imported routine: %ZHSLIB.INC
Imported routine: %ZJRNPURGE.MAC, compiling 13 classes, using 2 worker jobs
Compiling class %ZHSLIB.Audit.Log
Compiling class %ZHSLIB.HealthShareMgr
Compiling class %ZHSLIB.Services.Client
Compiling class %ZHSLIB.Services.NVPair
Compiling class %ZHSLIB.Services.Server
Compiling class %ZHSLIB.Services.TaskCalculateUpdatedRAndR
Compiling class %ZHSLIB.Services.TaskUpdateRolesAndResources
Compiling class %ZHSLIB.SessionEventUtil
Compiling class %ZHSLIB.UserChangePassword
Compiling class %ZHSLIB.UserLogin
Compiling class %ZHSLIB.UsersAndRoles
Compiling class %ZHSLIB.Audit.LogParticipant
Compiling table %ZHSLIB_Audit.Log
Compiling table %ZHSLIB_Audit.LogParticipant
Compiling routine %ZHSLIB.Audit.Log.1
Compiling routine %ZHSLIB.HealthShareMgr.1
Compiling routine %ZHSLIB.Services.Client.1
Compiling routine %ZHSLIB.Services.NVPair.1
Compiling routine %ZHSLIB.Services.Server.1
Compiling routine %ZHSLIB.Services.TaskCalculateUpdatedRAndR.1
Compiling routine %ZHSLIB.Services.TaskUpdateRolesAndResources.1
Compiling routine %ZHSLIB.SessionEventUtil.1
Compiling routine %ZHSLIB.UserChangePassword.1
Compiling routine %ZHSLIB.UserLogin.1
Compiling routine %ZHSLIB.UsersAndRoles.1
Compiling routine %ZHSLIB.Audit.LogParticipant.1
Compiling class %ZHSLIB.Component
Compiling routine %ZHSLIB.Component.1
Compiling class %ZHSLIB.Services.Client.GetNVPair
Compiling class %ZHSLIB.Services.Server.GetNVPair
Compiling routine %ZHSLIB.Services.Client.GetNVPair.1
Compiling routine %ZHSLIB.Services.Server.GetNVPair.1
Compiling routine : %ZJRNPURGE.MAC
Load finished successfully.


Scheduling inventory scan

Cache initialization complete

See the cboot.log file for a record of the installation.

Starting up HealthShare...
Once this completes, users may access HealthShare
Starting SCHL2016INTEGRATION
using 'cache.cpf' configuration file

Starting Control Process
Automatically configuring buffers
Allocated 634MB shared memory: 256MB global buffers, 300MB routine buffers
Creating a WIJ file to hold 31 megabytes of data
This copy of Cache has been licensed for use exclusively by:
License missing or unreadable.
Copyright (c) 1986-2017 by InterSystems Corporation
Any other use is a violation of your license agreement

1 alert(s) during startup. See cconsole.log for details.


You can point your browser to http://schl16intm1.nhsh.scot.nhs.uk:57772/csp/sys/UtilHome.csp
to access the management portal.

Installation completed successfully
spawn su - cacheusr -c csession SCHL2016INTEGRATION

Node: schl16intm1.nhsh.scot.nhs.uk, Instance: SCHL2016INTEGRATION

Username: SuperUser
Password: ***********
USER>zn "%SYS"

%SYS>do $system.OBJ.Load("/trak/iscbuild/trakautomation/conffiles/ZSTU.xml","ck")

Load started on 03/27/2018 10:26:37
Loading file /trak/iscbuild/trakautomation/conffiles/ZSTU.xml as xml
Imported routine: ZSTU.MAC
Compiling routine : ZSTU.MAC
Load finished successfully.

%SYS>
NOTE - Instance SCHL2016INTEGRATION has not been added to /etc/init.d/isccache to start at boot
########################################
Installing licenses...
/trak/iscbuild/trakautomation/cache.key
Installing license for /trak/schlPRD/int/hs/mgr
########################################
Configuring Environment SCHL2016INTEGRATION
Environment Configuration for schl : PRD (SCHL2016INTEGRATION)
Pri Journal /trak/schlPRD/int/jrn/pri/
Alt Journal /trak/schlPRD/int/jrn/alt/

10:26:37 Shutting down Cache
10:26:37 Notifying Clients
10:26:37 No user shutdown routines to execute
10:26:37 Stopping User Jobs
10:26:37 Stopping Network Servers
10:26:37 Withdrawing from License Domain
10:26:37 Waiting for users to stop
10:26:37 Stopping Client Networking
10:26:37 Removing database locks
10:26:37 Updating Journal File
10:26:39 Waiting for database updates to complete
10:26:39 Database updates complete
10:26:39 Stopping System Jobs
10:26:41 Shutdown complete
Starting SCHL2016INTEGRATION
using 'cache.cpf' configuration file

Starting Control Process
Allocated 12352MB shared memory: 10668MB global buffers, 1000MB routine buffers
Creating a WIJ file to hold 49 megabytes of data
This copy of Cache has been licensed for use exclusively by:
ISC TrakCare Development
Copyright (c) 1986-2017 by InterSystems Corporation
Any other use is a violation of your license agreement

########################################
zCustom.SnapBackup Install for schl : PRD (SCHL2016INTEGRATION)
Found Class: /trak/schlPRD/int/db/temp/isc_coding/trakautomation/zCustom.SnapBackup/zCustom.SnapBackup-20131212.xml
Found Call-in: /trak/schlPRD/int/db/temp/isc_coding/trakautomation/zCustom.SnapBackup/zCustom.SnapBackup.sh
Found snaplib: /trak/schlPRD/int/db/temp/isc_coding/trakautomation/zCustom.SnapBackup/snaplib.sh
spawn su - cacheusr -c csession SCHL2016INTEGRATION

Node: schl16intm1.nhsh.scot.nhs.uk, Instance: SCHL2016INTEGRATION

Username: SuperUser
Password: ***********
USER>zn "%SYS"

%SYS>write ##class(Security.Users).Exists("cachebackup")
0
%SYS>d ##Class(Security.Users).Create("cachebackup","%ALL","","Cache Backup user","","","",0,1,"",1,"","","",1,1)

%SYS>do ^SECURITY


1) User setup
2) Role setup
3) Service setup
4) Resource setup
5) Application setup
6) Auditing setup
7) Domain setup
8) SSL configuration setup
9) Mobile phone service provider setup
10) OpenAM Identity Services setup
11) Encryption key setup
12) System parameter setup
13) X509 User setup
14) Exit

Option? 12

1) Edit system options
2) Edit authentication options
3) Edit LDAP options
4) Display system options
5) Export All Security settings
6) Import All Security settings
7) Exit

Option? 2
Allow Unauthenticated access? Yes => Yes
Allow Operating System authentication? No => Yes
Allow Delegated Authorization for O/S authentication? No => No
Allow Password authentication? Yes => Yes
Allow Delegated authentication? Yes => Yes
Allow Kerberos authentication? Yes => Yes
Allow Delegated Authorization for Kerberos authentication? No => No
Allow LDAP authentication? No => No
Use Login Cookies? No => No
Allow Two-factor Time-based One-time Password authentication? No => No
Allow Two-factor SMS authentication? No => No

Confirm changes to authentication options? Yes => Yes
Authentication options updated

1) Edit system options
2) Edit authentication options
3) Edit LDAP options
4) Display system options
5) Export All Security settings
6) Import All Security settings
7) Exit

Option? 

1) User setup
2) Role setup
3) Service setup
4) Resource setup
5) Application setup
6) Auditing setup
7) Domain setup
8) SSL configuration setup
9) Mobile phone service provider setup
10) OpenAM Identity Services setup
11) Encryption key setup
12) System parameter setup
13) X509 User setup
14) Exit

Option? 3

1) Edit service
2) List services
3) Detailed list services
4) Export services
5) Import services
6) Exit

Option? 1

Service to edit? %Service_Terminal
Enabled? Yes => Yes
Allow Unauthenticated access? No => No
Allow Operating System authentication? Yes => Yes
Allow Password authentication? Yes => Yes
Allow Kerberos authentication? No => No
Allow Kerberos Credentials Cache authentication? No => No
Confirm changes to service %Service_Terminal? Yes => Yes
Service %Service_Terminal updated

Service to edit? 

1) Edit service
2) List services
3) Detailed list services
4) Export services
5) Import services
6) Exit

Option? 

1) User setup
2) Role setup
3) Service setup
4) Resource setup
5) Application setup
6) Auditing setup
7) Domain setup
8) SSL configuration setup
9) Mobile phone service provider setup
10) OpenAM Identity Services setup
11) Encryption key setup
12) System parameter setup
13) X509 User setup
14) Exit

Option? 
%SYS>do $system.OBJ.Load("/trak/schlPRD/int/db/temp/isc_coding/trakautomation/zCustom.SnapBackup/zCustom.SnapBackup-20131212.xml","ck")

Load started on 03/27/2018 10:27:13
Loading file /trak/schlPRD/int/db/temp/isc_coding/trakautomation/zCustom.SnapBackup/zCustom.SnapBackup-20131212.xml as xml
Imported class: zCustom.SnapBackup
Compiling class zCustom.SnapBackup
Compiling routine zCustom.SnapBackup.1
Load finished successfully.

%SYS>
########################################
Huge Pages memory configuration
Generating configuration
########################################
Setting Autostart....
Setting Autostart for SCHL2016INTEGRATION

Probably worth rebooting to ensure no memory fragmentation and test the config...
]0;root@schl16intm1:/trak/iscbuild/trakautomation[root@schl16intm1 trakautomation]# ^C
]0;root@schl16intm1:/trak/iscbuild/trakautomation[root@schl16intm1 trakautomation]# exit

Script done on Tue 27 Mar 2018 11:05:49 BST
